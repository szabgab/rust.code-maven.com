# Command line Interface with clap
{id: clap}

## Clap - Command Line Argument Parser
{id: clap-command-line-argument-parser}

* Start by using `std::env::args`
* See [Command line arguments - ARGS](args)

* [clap](https://crates.io/crates/clap) is the Command Line Argument Parser

* [clap documentation](https://docs.rs/clap/latest/clap/)

* Derive
* Builder

* Extension called [clap_complete](https://crates.io/search?q=clap_complete).

## Clap Single positional argument
{id: clap-single-positional-argument}

```
cargo add clap --features derive
```

![](examples/clap/single-positional-argument/Cargo.toml)
![](examples/clap/single-positional-argument/src/main.rs)

## Clap Several positional arguments
{id: clap-several-positional-arguments}

![](examples/clap/several-positional-arguments/src/main.rs)

## Clap Single long argument
{id: clap-single-long-argument}
{i: arg}
{i: long}

![](examples/clap/single-long-argument/Cargo.toml)
![](examples/clap/single-long-argument/src/main.rs)

## Clap Short arguments
{id: clap-short-arguments}
{i: short}

* We can allow to use `-x` short names (defaults to the first letter of the attribute)
* We can set the letter ourselves.

![](examples/clap/short-arguments/src/main.rs)

## Clap accepting string, number, bool - default values
{id: clap-string-number-bool-default}
{i: default_value}
{i: default_value_t}

![](examples/clap/number-string-bool/src/main.rs)


## Clap add help to each argument
{id: clap-add-help-to-each-argument}

![](examples/clap/help-with-arguments/src/main.rs)

## Clap show the version number from Cargo.toml
{id: clap-show-the-version-number}
{i: version}

![](examples/clap/show-version-number/src/main.rs)

## Clap Show the description of the crates using the about command
{id: clap-show-the-description}
{i: description}
{i: about}
{i: command}

![](examples/clap/show-description/Cargo.toml)
![](examples/clap/show-description/src/main.rs)

## Clap Show the description written in the code
{id: clap-show-the-description-from-code}

![](examples/clap/show-description-from-code/Cargo.toml)
![](examples/clap/show-description-from-code/src/main.rs)

## Clap show generated description
{id: clap-show-generated-description}

![](examples/clap/show-generated-description/Cargo.toml)
![](examples/clap/show-generated-description/src/main.rs)

## Clap validate number range
{id: clap-validate-number-range}
{i: value_parser!}

![](examples/clap/validate-number-range/src/main.rs)

## Clap subcommands
{id: clap-subcommands}

![](examples/clap/subcommands/src/main.rs)

## Clap mutually exclusive
{id: clap-mutually-exclusive}

![](examples/clap/mutually-exclusive-or/src/main.rs)

## Clap mutually exclusive with group
{id: clap-mutually-exclusive-with-group}

![](examples/clap/mutually-exclusive-group/src/main.rs)

## Clap example for CLI
{id: clap-example}
{i: CLI}


![](examples/clap/clap-example/Cargo.toml)
![](examples/clap/clap-example/src/main.rs)

## Clap: improving the help with value_name
{id: clap-value-name}
{i: value_name}

By default the help (generated by providing `-h`) includes the name of the field in angle brackets.
This is usually a repetition of the parameter name in upper case letters.
In many cases this gives good indication of the value the program is expecting, but sometimes you might want to give a better hint.
In such cases you can set the string that will appear inside the angle brackets using the `value_name` parameter.

* In this example the input field has the default: `INPUT` while the out field was set to `FILENAME` by the `value_field.`

![](examples/clap/value-name/src/main.rs)
![](examples/clap/value-name/out.out)


## Clap: one of a fixed list of values (enumerated)
{id: clap-one-of-a-fixed-list-of-values}
{i: enum}
{i: ValueEnum}

Using Clap we can define a parameter to accept only values from a fixed list of possible values.
For this we create an `enum` where all variants of the enum correspond to the values we would like to accept.
The `enum` has to derive from `clap::ValueEnum` and also from `Clone` and `Copy`.

We can also use the `alias` to allow alternate values to be mapped onto specific variants of the enum.

Then we can pass the value like this:

```
cargo run -q -- --color blue
cargo run -q -- --color red

cargo run -q -- --color green
cargo run -q -- --color Green
cargo run -q -- --color verde
```

![](examples/clap/enumerated/src/main.rs)


## Clap and environment variables
{id: clap-and-environment-variables}
{i: env}

In order for this feature to work we need to enable both the `derive` and the `env` features of Clap so we start with:

```
cargo add clap -F derive -F env
```

If we don't enable the `env` feature we'll get an error: **no method named `env` found for struct `Arg` in the current scope** with **method not found in `Arg`**.

![](examples/clap/environment-variable/src/main.rs)


In this case we can pass the hostname either as a command line flag or by setting the appropriate environmnet variable.

```
cargo run -- --hostname localhost
DEMO_HOSTNAME=localhost cargo run
```

Setting the envronment can be done on the same row (on linux and macOS) as we see in our example, but it can be also set earlier.

## Clap - set default value if other flag provided
{id: clap-set-default-value-if-other-flag-provided}
{i: default_value_if}
{i: ArgPredicate}
{i: Equals}
{i: OsStr}

* If `log_to_file` is true then `log_file` will get a default value.

* Actually I am not sure this is such a good example for `default_value_if` as setting the default even if the `log_to_file` is `False` would not be a problem. The code just would not use it.

* [ArgPredicate](https://docs.rs/clap/latest/clap/builder/enum.ArgPredicate.html)
* [default_value_if](https://docs.rs/clap/latest/clap/struct.Arg.html#method.default_value_if)

![](examples/clap/default-value-if-equals/src/main.rs)

```
$ cargo run -q
Args: Cli { log_to_file: false, log_file: None }

$ cargo run -q -- --log-to-file
Args: Cli { log_to_file: true, log_file: Some("my.log") }

$ cargo run -q -- --log-to-file --log-file other.log
Args: Cli { log_to_file: true, log_file: Some("other.log") }

$ cargo run -q -- --log-file other.log
Args: Cli { log_to_file: false, log_file: Some("other.log") }
```

## Clap - set default value if other argument provided
{id: clap-set-default-value-if-other-argument-provided}
{i: default_value_if}
{i: ArgPredicate}
{i: IsPresent}

* This is a similar example but now we say that if the user provides a name for the logfile then we'll automatically turn on logging to that file.
* This might be more logical than the previous one, but I am not sure I like this either.

![](examples/clap/default-value-if-ispresent/src/main.rs)

```
$ cargo run -q
Args: Cli { log_to_file: false, log_file: "my.log" }

$ cargo run -q -- --log-to-file
Args: Cli { log_to_file: true, log_file: "my.log" }

$ cargo run -q -- --log-file other.log
Args: Cli { log_to_file: true, log_file: "other.log" }

$ cargo run -q -- --log-to-file  --log-file other.log
Args: Cli { log_to_file: true, log_file: "other.log" }
```

## Clap - set default value based on another flag
{id: clap-set-default-value-based-on-another-flag}

* `mode` is required argument.
* The value of `log_level` is based on the `mode`.
* We can also set the `log_level` manually.

```
$ cargo run -q -- --mode devel
Args: Cli { mode: Devel, log_level: 1 }

$ cargo run -q -- --mode test
Args: Cli { mode: Test, log_level: 2 }

$ cargo run -q -- --mode release
Args: Cli { mode: Release, log_level: 0 }

$ cargo run -q -- --mode release --log-level 10
Args: Cli { mode: Release, log_level: 10 }
```

![](examples/clap/default-value-if-equals-multiple-values/src/main.rs)


## Clap complete enum - name of shell
{id: clap-complete-name-of-shell-enum}
{i: clap_complete}
{i: Shell}

* [clap_complete](https://crates.io/crates/clap_complete)
* [Shell](https://docs.rs/clap_complete/latest/clap_complete/shells/enum.Shell.html)

![](examples/clap/clap-complete-shell/src/main.rs)

## Clap: default value only if the flag was provides
{id: clap-default-on-condition}
{i: TBD}

```
./program --input 100     # set input to Some(100)
./program --input         # set input to the dafult Some(42)
./program                 # input is None


## Exercise: implement accepting the parameters of wc
{id: exercise-command-line-of-wc}

You can get it either by typing "man wc" in your terminal or by visiting [man wc](https://linux.die.net/man/1/wc).


## Solution: implement accepting the parameters of wc
{id: solution-command-line-of-wc}
{i: TBD}

![](examples/clap/wc-cli/src/main.rs)


